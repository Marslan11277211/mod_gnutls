- !connection
  description: >-
    Connection to the default (first) vhost must work without SNI.
  gnutls_params:
    - x509cafile=authority/x509.pem
    - disable-sni
  actions:
    - !request
      path: /vhost0/test.txt
      expect:
        status: 200
        body:
          exactly: |
            test
- !connection
  description: >-
    Connection to the default vhost must work with SNI.
  gnutls_params:
    - x509cafile=authority/x509.pem
  actions:
    - !request
      path: /vhost0/test.txt
      expect:
        status: 200
        body:
          exactly: |
            test
- !connection
  description: >-
    Connection to the second vhost must work with SNI.
  gnutls_params:
    - x509cafile=authority/x509.pem
    - verify-hostname=meow.test
    - sni-hostname=meow.test
  actions:
    - !request
      path: /meow/test.txt
      headers:
        Host: meow.test
      expect:
        status: 200
        body:
          exactly: |
            test
- !connection
  description: >-
    Send SNI for first vhost (localhost), but a Host header for the
    second one (vhost.example.com). Expect error 421.
  gnutls_params:
    - x509cafile=authority/x509.pem
  actions:
    - !request
      path: /dump.cgi
      headers:
        Host: meow.test
      expect:
        status: 421
        body:
          - 'Misdirected Request'
          - 'Server Name Indication (SNI)'
