#!/bin/bash

TEST_NAME="$1"

confirmed=0

while [ "$confirmed" -eq 0 ]; do

    if [ -z "${TEST_NAME}" ]; then
	read -e -p "describe your new test briefly: " -i "$tname" TEST_NAME
    fi

    tname="${TEST_NAME// /_}"
    declare -i newnum=0
    while [ -d tests/$(printf "%02d_*" "${newnum}") ]; do
	newnum=$((newnum + 1))
    done
    newname="$(printf "%02d_%s" "${newnum}" "$tname")"

    read -p "your new test will be named tests/$newname. OK? [Y/n]"
    if [ "$REPLY" == "" ] || [ "${REPLY/Y/y}" == "y" ]; then
        confirmed=1
    fi
done

cp -a tests/00_basic "tests/$newname"
# derive script name, the actual script will be generated by make
newscript="test-${newname}.bash"

echo "You can now edit ${newname}."
echo "Run the test with TESTS=\"${newscript}\" make -e check."
echo "When ready, add ${newscript} to test_scripts in Makefile.am."
